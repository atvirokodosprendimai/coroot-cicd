name: Copy Org Secrets to Repo

# Copies org-level secrets into this repo so hetzner-prices.yml can use them.
# Requires PUSH_TOKEN (org-level PAT with secrets:write on this repo).
#
# Run this once after rotating org-level secrets, or whenever the repo-level
# copies need refreshing.

on:
  workflow_dispatch:

jobs:
  copy-secrets:
    name: Copy secrets to coroot-cicd
    runs-on: ubuntu-latest
    steps:
      - name: Copy HETZNER_TOKEN
        env:
          GH_TOKEN: ${{ secrets.PUSH_TOKEN }}
        run: |
          printf '%s' "${{ secrets.HETZNER_TOKEN }}" | gh secret set HETZNER_TOKEN \
            --repo atvirokodosprendimai/coroot-cicd

      - name: Copy COROOT_EMAIL
        env:
          GH_TOKEN: ${{ secrets.PUSH_TOKEN }}
        run: |
          printf '%s' "${{ secrets.COROOT_EMAIL }}" | gh secret set COROOT_EMAIL \
            --repo atvirokodosprendimai/coroot-cicd

      - name: Copy COROOT_PASSWORD
        env:
          GH_TOKEN: ${{ secrets.PUSH_TOKEN }}
        run: |
          printf '%s' "${{ secrets.COROOT_PASSWORD }}" | gh secret set COROOT_PASSWORD \
            --repo atvirokodosprendimai/coroot-cicd
